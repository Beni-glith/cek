<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Proxy</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .pagination button {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
        .filter-buttons {
            margin-bottom: 20px;
            text-align: center;
        }
        .filter-buttons button {
            padding: 5px 10px;
            margin: 0 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Daftar Proxy</h1>
    
    <div class="filter-buttons" id="filterButtons">
        <!-- Tombol filter ID negara akan ditambahkan di sini -->
    </div>

    <table id="proxyTable">
        <thead>
            <tr>
                <th>IP</th>
                <th>Port</th>
                <th>ID</th>
                <th>ISP</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data akan ditambahkan di sini -->
        </tbody>
    </table>

    <div class="pagination" id="pagination">
        <!-- Pagination akan ditambahkan di sini -->
    </div>

    <script>
        const itemsPerPage = 10; // Jumlah data per halaman
        let currentPage = 1;
        let proxyData = [];
        let filteredData = [];

        // Ambil data dari file
        fetch('https://bmkg.xyz/update_proxyip.txt')
            .then(response => response.text())
            .then(data => {
                // Pisahkan data per baris
                const lines = data.split('\n');
                proxyData = lines.map(line => line.split(',').map(col => col.trim()));

                // Ambil ID unik (negara), pastikan ID tidak kosong
                const ids = [...new Set(proxyData.map(item => item[2]).filter(id => id))];
                createFilterButtons(ids);

                // Tampilkan data pertama kali
                filterByID(null);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // Fungsi untuk membuat tombol filter ID negara
        function createFilterButtons(ids) {
            const filterContainer = document.getElementById('filterButtons');
            filterContainer.innerHTML = ''; // Hapus tombol sebelumnya

            const allButton = document.createElement('button');
            allButton.textContent = 'Semua';
            allButton.onclick = () => filterByID(null);
            filterContainer.appendChild(allButton);

            ids.forEach(id => {
                const button = document.createElement('button');
                button.textContent = id;
                button.onclick = () => filterByID(id);
                filterContainer.appendChild(button);
            });
        }

        // Fungsi untuk memfilter data berdasarkan ID negara
        function filterByID(id) {
            filteredData = id ? proxyData.filter(item => item[2] === id) : [...proxyData];
            currentPage = 1; // Reset ke halaman pertama
            displayPage(currentPage);
            createPagination();
        }

        // Fungsi untuk menampilkan data per halaman
        function displayPage(page) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const tableBody = document.querySelector('#proxyTable tbody');
            tableBody.innerHTML = ''; // Hapus tabel sebelumnya

            // Loop untuk menampilkan data di halaman yang dipilih
            filteredData.slice(startIndex, endIndex).forEach(cols => {
                const row = document.createElement('tr');
                cols.forEach(col => {
                    const cell = document.createElement('td');
                    cell.textContent = col;
                    row.appendChild(cell);
                });
                tableBody.appendChild(row);
            });
        }

        // Fungsi untuk membuat pagination dengan maksimal 5 tombol
        function createPagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            if (totalPages <= 1) return; // Jika hanya 1 halaman, tidak perlu pagination

            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (startPage === 1) {
                endPage = Math.min(5, totalPages);
            } else if (endPage === totalPages) {
                startPage = Math.max(1, totalPages - 4);
            }

            // Tombol "Previous"
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = 'Previous';
                prevButton.onclick = () => changePage(currentPage - 1);
                paginationContainer.appendChild(prevButton);
            }

            // Tombol halaman dengan batas 5 tombol
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.onclick = () => changePage(i);
                if (i === currentPage) {
                    pageButton.style.fontWeight = 'bold';
                }
                paginationContainer.appendChild(pageButton);
            }

            // Tombol "Next"
            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next';
                nextButton.onclick = () => changePage(currentPage + 1);
                paginationContainer.appendChild(nextButton);
            }
        }

        // Fungsi untuk mengubah halaman
        function changePage(page) {
            if (page < 1 || page > Math.ceil(filteredData.length / itemsPerPage)) return;
            currentPage = page;
            displayPage(currentPage);
            createPagination();
        }
    </script>
</body>
</html>
