<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Proxy</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .pagination button {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
        .filter-container {
            display: flex;
            flex-wrap: nowrap;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 10px 0;
            white-space: nowrap;
        }
        .filter-container button {
            padding: 5px 10px;
            cursor: pointer;
            border: 1px solid #000;
            background-color: #f0f0f0;
            white-space: nowrap;
        }
        .filter-container button.active {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Daftar Proxy</h1>
    
    <div class="filter-container" id="filterButtons">
        <!-- Tombol filter ID negara akan ditambahkan di sini -->
    </div>

    <table id="proxyTable">
        <thead>
            <tr>
                <th>IP</th>
                <th>Port</th>
                <th>ID</th>
                <th>ISP</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data akan ditambahkan di sini -->
        </tbody>
    </table>

    <div class="pagination" id="pagination">
        <!-- Pagination akan ditambahkan di sini -->
    </div>

    <script>
        const itemsPerPage = 10; // Jumlah data per halaman
        let currentPage = 1;
        let proxyData = [];
        let filteredData = [];
        let currentFilter = null;

        // Ambil data dari file
        fetch('https://bmkg.xyz/update_proxyip.txt')
            .then(response => response.text())
            .then(data => {
                // Pisahkan data per baris
                const lines = data.split('\n');
                proxyData = lines.map(line => line.split(',').map(col => col.trim()));

                // Ambil ID unik (negara), pastikan ID tidak kosong
                const ids = [...new Set(proxyData.map(item => item[2]).filter(id => id))];
                createFilterButtons(ids);

                // Tampilkan data pertama kali dengan filter pertama (default ke ID pertama)
                if (ids.length > 0) {
                    filterByID(ids[0]); // Pilih ID pertama sebagai default
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

        // Fungsi untuk membuat tombol filter ID negara
        function createFilterButtons(ids) {
            const filterContainer = document.getElementById('filterButtons');
            filterContainer.innerHTML = ''; // Hapus tombol sebelumnya

            ids.forEach((id, index) => {
                const button = document.createElement('button');
                button.textContent = id;
                button.onclick = () => filterByID(id);
                if (index === 0) {
                    button.classList.add('active'); // Jadikan tombol pertama aktif
                    currentFilter = id;
                }
                filterContainer.appendChild(button);
            });
        }

        // Fungsi untuk memfilter data berdasarkan ID negara
        function filterByID(id) {
            filteredData = proxyData.filter(item => item[2] === id);
            currentPage = 1; // Reset ke halaman pertama

            // Update tombol aktif
            const buttons = document.querySelectorAll('.filter-container button');
            buttons.forEach(button => {
                if (button.textContent === id) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });

            displayPage(currentPage);
            createPagination();
        }

        // Fungsi untuk menampilkan data per halaman
        function displayPage(page) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const tableBody = document.querySelector('#proxyTable tbody');
            tableBody.innerHTML = ''; // Hapus tabel sebelumnya

            // Loop untuk menampilkan data di halaman yang dipilih
            filteredData.slice(startIndex, endIndex).forEach(cols => {
                const row = document.createElement('tr');
                cols.forEach(col => {
                    const cell = document.createElement('td');
                    cell.textContent = col;
                    row.appendChild(cell);
                });
                tableBody.appendChild(row);
            });
        }

        // Fungsi untuk membuat pagination dengan maksimal 5 tombol di awal
        function createPagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            if (totalPages <= 1) return; // Jika hanya 1 halaman, tidak perlu pagination

            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (startPage === 1) {
                endPage = Math.min(5, totalPages);
            } else if (endPage === totalPages) {
                startPage = Math.max(1, totalPages - 4);
            }

            // Tombol "Awal"
            const firstButton = document.createElement('button');
            firstButton.textContent = '<<<';
            firstButton.onclick = () => changePage(1);
            paginationContainer.appendChild(firstButton);

            // Tombol "Previous"
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = '<<';
                prevButton.onclick = () => changePage(currentPage - 1);
                paginationContainer.appendChild(prevButton);
            }

            // Tombol halaman dengan batas 5 tombol
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.onclick = () => changePage(i);
                if (i === currentPage) {
                    pageButton.style.fontWeight = 'bold';
                }
                paginationContainer.appendChild(pageButton);
            }

            // Tombol "Next"
            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.textContent = '>>';
                nextButton.onclick = () => changePage(currentPage + 1);
                paginationContainer.appendChild(nextButton);
            }

            // Tombol "Akhir"
            const lastButton = document.createElement('button');
            lastButton.textContent = '>>>';
            lastButton.onclick = () => changePage(totalPages);
            paginationContainer.appendChild(lastButton);
        }

        // Fungsi untuk mengubah halaman
        function changePage(page) {
            if (page < 1 || page > Math.ceil(filteredData.length / itemsPerPage)) return;
            currentPage = page;
            displayPage(currentPage);
            createPagination();
        }
    </script>
</body>
</html>
